pipeline {
    agent any
    stages {
        stage('init') {
            steps {
                sh 'pip3 install -r script/requirements.txt'
            }
        }
        stage('build') {
            environment {
                HOME = "${env.WORKSPACE}"
            }
            steps {
                steps {
                    sh 'python3 -c '
                        "#!/usr/bin/env python3
                        import sys

                        sys.path.append("../../")
                        from shell import run

                        run.exec_file({
                            "script.domain.source.mysql": ["rebuild_mysql"],
                            "script.domain.source.java": ["build_plugin", "build_api", "build_api_image", "start_api_compose"]
                        })"' --param param_api_image_tag=play
                        '
                }
            }
        }
    // stage('deploy') {
    //     steps{
    //         sh 'sh shell/play/start_api.sh --param param_api_image_tag=play --skip-rm-output'
    //     }
    // }
    }
}
